<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><link rel=icon type=image/png href=/images/favicon.ico><title itemprop=name>Generate beautiful JSON from PostgreSQL | thoughts, obsessions and mostly rants</title><meta name=description content="thoughts, obsessions and mostly rants"><meta name=author content="Rudra Narayan"><link rel=stylesheet href=/scss/main.min.dce009fb0e8e452ae77ff6285fa6b7f4006e5e178b6795d59536f0d627ff4d9a.css media=screen><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.8.1/css/all.css integrity=sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf crossorigin=anonymous><meta property="og:title" content="Generate beautiful JSON from PostgreSQL | thoughts, obsessions and mostly rants"><meta name=twitter:title content="Generate beautiful JSON from PostgreSQL | thoughts, obsessions and mostly rants"><meta itemprop=name content="Generate beautiful JSON from PostgreSQL | thoughts, obsessions and mostly rants"><meta name=application-name content="Generate beautiful JSON from PostgreSQL | thoughts, obsessions and mostly rants"><meta property="og:site_name" content="Rudra Narayan Kar blog"><meta name=description content="thoughts, obsessions and mostly rants"><meta itemprop=description content="thoughts, obsessions and mostly rants"><meta property="og:description" content="thoughts, obsessions and mostly rants"><meta name=twitter:description content="thoughts, obsessions and mostly rants"><base href=https://rudra.dev/posts/generate-beautiful-json-from-postgresql/><link rel=canonical href=https://rudra.dev/posts/generate-beautiful-json-from-postgresql/ itemprop=url><meta name=url content="https://rudra.dev/posts/generate-beautiful-json-from-postgresql/"><meta name=twitter:url content="https://rudra.dev/posts/generate-beautiful-json-from-postgresql/"><meta property="og:url" content="https://rudra.dev/posts/generate-beautiful-json-from-postgresql/"><meta property="og:article:author" content="mrprofessor"><meta property="article:author" content="mrprofessor"><meta name=author content="mrprofessor"><meta property="og:locale" content="en"><meta name=language content="English"><meta property="og:updated_time" content="2020-05-19T00:00:00+0530"><link rel=sitemap type=application/xml title=Sitemap href=https://rudra.dev/sitemap.xml><meta property="og:type" content="article"><meta property="article:publisher" content="https://github.com/mrprofessor"><meta property="og:article:published_time" content="2020-05-19T00:00:00+0530"><meta property="article:published_time" content="2020-05-19T00:00:00+0530"><meta property="og:article:author" content="Rudra narayan"><meta property="article:author" content="Rudra narayan"><meta name=author content="Rudra narayan"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Generate beautiful JSON from PostgreSQL","author":{"@type":"Person","name":"https:\/\/github.com\/mrprofessor"},"datePublished":"2020-05-19","description":"","wordCount":744,"mainEntityOfPage":"True","dateModified":"2020-05-19","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"rudra narayan","logo":{"@type":"imageObject","url":"https://rudra.dev/images/favicon.ico"}}}</script><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content="@weary_beard"><meta name=twitter:creator content="@weary_beard"><meta name=theme-color content="#141414"><meta name=msapplication-TileColor content="#141414"><meta name=keywords content><meta name=imagemode content="force"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=HandheldFriendly content="True"><meta name=msapplication-tap-highlight content="no"><meta name=apple-mobile-web-app-title content="Rudra Narayan Kar blog"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=apple-touch-fullscreen content="yes"></head><body><div class=layout><header><div class=title-wrapper><a href=/><h2 class=title>rudra narayan</h2></a><nav><ul><li><a href=/posts/>posts</a></li><li><a href=/projects/>projects</a></li><li><a href="https://docs.google.com/gview?url=https://github.com/mrprofessor/resume/raw/master/rudra_narayan_resume.pdf&embedded=true" target=_blank>resume</a></li></ul></nav></div></header><main><article><h1>Generate beautiful JSON from PostgreSQL</h1><time>May 19, 2020</time><div class=tags><ul><li><a href=/tags/postgresql>postgresql</a></li><li><a href=/tags/json>json</a></li><li><a href=/tags/sql>sql</a></li></ul></div><div class=blog-post-content><p>PostgreSQL provides a set of built-in <a href=https://www.postgresql.org/docs/current/functions-json.html#FUNCTIONS-JSON-CREATION-TABLE target=_blank>JSON
creation functions</a>
that can be used to build basic JSON structures. This increases the performance up to 10 times more than building it at the back-end layer.</p><blockquote><p>This post is about building different JSON structures using PostgreSQL
built-in functions. It doesn&rsquo;t talk about storing and manipulating
JSON in PostgreSQL.</p></blockquote><p>In order to proceed with some examples, first we need to setup a test
database.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>  <span style=color:#080;font-weight:700>CREATE</span> <span style=color:#080;font-weight:700>DATABASE</span> jsonland
</code></pre></div><p>Let&rsquo;s create the following tables.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>  <span style=color:#080;font-weight:700>CREATE</span> <span style=color:#080;font-weight:700>TABLE</span> <span style=background-color:#fff0f0>&#34;user&#34;</span> (
    id <span style=color:#007020>SERIAL</span> <span style=color:#080;font-weight:700>NOT</span> <span style=color:#080;font-weight:700>NULL</span>,
    name <span style=color:#007020>VARCHAR</span>(<span style=color:#00d;font-weight:700>100</span>),
    email_address <span style=color:#007020>VARCHAR</span>(<span style=color:#00d;font-weight:700>150</span>),
    <span style=color:#080;font-weight:700>PRIMARY</span> <span style=color:#080;font-weight:700>KEY</span>(id)
  )

  <span style=color:#080;font-weight:700>CREATE</span> <span style=color:#080;font-weight:700>TABLE</span> team (
    id <span style=color:#007020>SERIAL</span> <span style=color:#080;font-weight:700>NOT</span> <span style=color:#080;font-weight:700>NULL</span>,
    name <span style=color:#007020>VARCHAR</span>(<span style=color:#00d;font-weight:700>100</span>),
    <span style=color:#080;font-weight:700>PRIMARY</span> <span style=color:#080;font-weight:700>KEY</span>(id)
  )

  <span style=color:#080;font-weight:700>CREATE</span> <span style=color:#080;font-weight:700>TABLE</span> team_user (
    id <span style=color:#007020>SERIAL</span> <span style=color:#080;font-weight:700>NOT</span> <span style=color:#080;font-weight:700>NULL</span>,
    team_id <span style=color:#007020>INTEGER</span> <span style=color:#080;font-weight:700>NOT</span> <span style=color:#080;font-weight:700>NULL</span>,
    user_id <span style=color:#007020>INTEGER</span> <span style=color:#080;font-weight:700>NOT</span> <span style=color:#080;font-weight:700>NULL</span>,
    <span style=color:#080;font-weight:700>FOREIGN</span> <span style=color:#080;font-weight:700>KEY</span>(team_id) <span style=color:#080;font-weight:700>REFERENCES</span> <span style=background-color:#fff0f0>&#34;team&#34;</span> (id),
    <span style=color:#080;font-weight:700>FOREIGN</span> <span style=color:#080;font-weight:700>KEY</span>(user_id) <span style=color:#080;font-weight:700>REFERENCES</span> <span style=background-color:#fff0f0>&#34;user&#34;</span> (id),
    <span style=color:#080;font-weight:700>PRIMARY</span> <span style=color:#080;font-weight:700>KEY</span>(id)
  )
</code></pre></div><p>Let&rsquo;s Seed the tables with random data.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>  <span style=color:#080;font-weight:700>INSERT</span> <span style=color:#080;font-weight:700>INTO</span> <span style=background-color:#fff0f0>&#34;team&#34;</span> (<span style=background-color:#fff0f0>&#34;id&#34;</span>, <span style=background-color:#fff0f0>&#34;name&#34;</span>)
  <span style=color:#080;font-weight:700>VALUES</span> (<span style=color:#00d;font-weight:700>1</span>, <span style=background-color:#fff0f0>&#39;team1&#39;</span>), (<span style=color:#00d;font-weight:700>2</span>, <span style=background-color:#fff0f0>&#39;team2&#39;</span>);

  <span style=color:#080;font-weight:700>INSERT</span> <span style=color:#080;font-weight:700>INTO</span> <span style=background-color:#fff0f0>&#34;user&#34;</span> (<span style=background-color:#fff0f0>&#34;id&#34;</span>, <span style=background-color:#fff0f0>&#34;name&#34;</span>, <span style=background-color:#fff0f0>&#34;email_address&#34;</span>)
  <span style=color:#080;font-weight:700>VALUES</span> (<span style=color:#00d;font-weight:700>1</span>, <span style=background-color:#fff0f0>&#39;user1&#39;</span>, <span style=background-color:#fff0f0>&#39;user1@mail.com&#39;</span>), (<span style=color:#00d;font-weight:700>2</span>, <span style=background-color:#fff0f0>&#39;user2&#39;</span>, <span style=background-color:#fff0f0>&#39;user2@mail.com&#39;</span>);

  <span style=color:#080;font-weight:700>INSERT</span> <span style=color:#080;font-weight:700>INTO</span> <span style=background-color:#fff0f0>&#34;team_user&#34;</span> (<span style=background-color:#fff0f0>&#34;id&#34;</span>, <span style=background-color:#fff0f0>&#34;team_id&#34;</span>, <span style=background-color:#fff0f0>&#34;user_id&#34;</span>)
  <span style=color:#080;font-weight:700>VALUES</span> (<span style=color:#00d;font-weight:700>1</span>, <span style=color:#00d;font-weight:700>1</span>, <span style=color:#00d;font-weight:700>1</span>), (<span style=color:#00d;font-weight:700>2</span>, <span style=color:#00d;font-weight:700>1</span>, <span style=color:#00d;font-weight:700>2</span>), (<span style=color:#00d;font-weight:700>3</span>, <span style=color:#00d;font-weight:700>2</span>, <span style=color:#00d;font-weight:700>2</span>);
</code></pre></div><p>We have created three tables i.e. <code>team</code>, <code>user</code> and <code>team_user</code>.
<code>team_user</code> table maps one-to-may the relationship between users and
teams.</p><h2 id=1-get-the-table-data-as-json-objects><strong>1. Get the table data as JSON objects</strong></h2><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>  <span style=color:#080;font-weight:700>SELECT</span> row_to_json(<span style=background-color:#fff0f0>&#34;user&#34;</span>) <span style=color:#080;font-weight:700>FROM</span> <span style=background-color:#fff0f0>&#34;user&#34;</span>;

  <span style=color:#333>+</span><span style=color:#888>-----------------------------------------------------------+
</span><span style=color:#888></span>  <span style=color:#333>|</span> row_to_json                                               <span style=color:#333>|</span>
  <span style=color:#333>|</span><span style=color:#888>-----------------------------------------------------------|
</span><span style=color:#888></span>  <span style=color:#333>|</span> <span style=color:red;background-color:#faa>{</span><span style=background-color:#fff0f0>&#34;id&#34;</span>:<span style=color:#00d;font-weight:700>1</span>,<span style=background-color:#fff0f0>&#34;name&#34;</span>:<span style=background-color:#fff0f0>&#34;user1&#34;</span>,<span style=background-color:#fff0f0>&#34;email_address&#34;</span>:<span style=background-color:#fff0f0>&#34;user1@gmail.com&#34;</span><span style=color:red;background-color:#faa>}</span> <span style=color:#333>|</span>
  <span style=color:#333>|</span> <span style=color:red;background-color:#faa>{</span><span style=background-color:#fff0f0>&#34;id&#34;</span>:<span style=color:#00d;font-weight:700>2</span>,<span style=background-color:#fff0f0>&#34;name&#34;</span>:<span style=background-color:#fff0f0>&#34;user2&#34;</span>,<span style=background-color:#fff0f0>&#34;email_address&#34;</span>:<span style=background-color:#fff0f0>&#34;user2@gmail.com&#34;</span><span style=color:red;background-color:#faa>}</span> <span style=color:#333>|</span>
  <span style=color:#333>+</span><span style=color:#888>-----------------------------------------------------------+
</span></code></pre></div><p>The above mentioned query will return all the columns of each row as
JSON objects.</p><h2 id=2-get-the-table-data-with-specific-columns><strong>2. Get the table data with specific columns</strong></h2><p>We can specify the particular columns we need rather than getting all at
once.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>  <span style=color:#080;font-weight:700>SELECT</span> row_to_json(<span style=color:#080;font-weight:700>row</span>(<span style=background-color:#fff0f0>&#39;id&#39;</span>, <span style=background-color:#fff0f0>&#39;name&#39;</span>)) <span style=color:#080;font-weight:700>FROM</span> <span style=background-color:#fff0f0>&#34;user&#34;</span>;

  <span style=color:#333>+</span><span style=color:#888>-------------------------+
</span><span style=color:#888></span>  <span style=color:#333>|</span> row_to_json             <span style=color:#333>|</span>
  <span style=color:#333>|</span><span style=color:#888>-------------------------|
</span><span style=color:#888></span>  <span style=color:#333>|</span> <span style=color:red;background-color:#faa>{</span><span style=background-color:#fff0f0>&#34;f1&#34;</span>:<span style=background-color:#fff0f0>&#34;id&#34;</span>,<span style=background-color:#fff0f0>&#34;f2&#34;</span>:<span style=background-color:#fff0f0>&#34;name&#34;</span><span style=color:red;background-color:#faa>}</span> <span style=color:#333>|</span>
  <span style=color:#333>|</span> <span style=color:red;background-color:#faa>{</span><span style=background-color:#fff0f0>&#34;f1&#34;</span>:<span style=background-color:#fff0f0>&#34;id&#34;</span>,<span style=background-color:#fff0f0>&#34;f2&#34;</span>:<span style=background-color:#fff0f0>&#34;name&#34;</span><span style=color:red;background-color:#faa>}</span> <span style=color:#333>|</span>
  <span style=color:#333>+</span><span style=color:#888>-------------------------+
</span></code></pre></div><p>Now certainly the keys <code>f1</code> and <code>f2</code> in the objects are not very useful
to us. We would rather want the column names instead of those keys.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>  <span style=color:#080;font-weight:700>SELECT</span> row_to_json(users) <span style=color:#080;font-weight:700>FROM</span> (<span style=color:#080;font-weight:700>SELECT</span> id, name <span style=color:#080;font-weight:700>FROM</span> <span style=background-color:#fff0f0>&#34;user&#34;</span>) <span style=color:#080;font-weight:700>AS</span> users;

  <span style=color:#333>+</span><span style=color:#888>-------------------------+
</span><span style=color:#888></span>  <span style=color:#333>|</span> row_to_json             <span style=color:#333>|</span>
  <span style=color:#333>|</span><span style=color:#888>-------------------------|
</span><span style=color:#888></span>  <span style=color:#333>|</span> <span style=color:red;background-color:#faa>{</span><span style=background-color:#fff0f0>&#34;id&#34;</span>:<span style=color:#00d;font-weight:700>1</span>,<span style=background-color:#fff0f0>&#34;name&#34;</span>:<span style=background-color:#fff0f0>&#34;user1&#34;</span><span style=color:red;background-color:#faa>}</span> <span style=color:#333>|</span>
  <span style=color:#333>|</span> <span style=color:red;background-color:#faa>{</span><span style=background-color:#fff0f0>&#34;id&#34;</span>:<span style=color:#00d;font-weight:700>2</span>,<span style=background-color:#fff0f0>&#34;name&#34;</span>:<span style=background-color:#fff0f0>&#34;user2&#34;</span><span style=color:red;background-color:#faa>}</span> <span style=color:#333>|</span>
  <span style=color:#333>+</span><span style=color:#888>-------------------------+
</span></code></pre></div><h2 id=3-get-the-table-data-as-a-single-json-object><strong>3. Get the table data as a single JSON object</strong></h2><p>The above examples return us multiple JSON objects(one for each row).
Ideally we would want a single array of these objects which won&rsquo;t need
any further manipulation at back-end layer.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>  <span style=color:#080;font-weight:700>SELECT</span> array_to_json(array_agg(row_to_json(users)))
      <span style=color:#080;font-weight:700>FROM</span> (
          <span style=color:#080;font-weight:700>SELECT</span> id, name <span style=color:#080;font-weight:700>from</span> <span style=background-color:#fff0f0>&#34;user&#34;</span>
      ) users

  <span style=color:#888>-- OR
</span><span style=color:#888></span>
  <span style=color:#080;font-weight:700>SELECT</span> json_agg(row_to_json(users))
      <span style=color:#080;font-weight:700>FROM</span> (
          <span style=color:#080;font-weight:700>SELECT</span> id, name <span style=color:#080;font-weight:700>from</span> <span style=background-color:#fff0f0>&#34;user&#34;</span>
      ) users

  <span style=color:#333>+</span><span style=color:#888>----------------------------------------------------+
</span><span style=color:#888></span>  <span style=color:#333>|</span> json_agg                                           <span style=color:#333>|</span>
  <span style=color:#333>|</span><span style=color:#888>----------------------------------------------------|
</span><span style=color:#888></span>  <span style=color:#333>|</span> [<span style=color:red;background-color:#faa>{</span><span style=background-color:#fff0f0>&#34;id&#34;</span>:<span style=color:#00d;font-weight:700>1</span>,<span style=background-color:#fff0f0>&#34;name&#34;</span>:<span style=background-color:#fff0f0>&#34;user1&#34;</span><span style=color:red;background-color:#faa>}</span>, <span style=color:red;background-color:#faa>{</span><span style=background-color:#fff0f0>&#34;id&#34;</span>:<span style=color:#00d;font-weight:700>2</span>,<span style=background-color:#fff0f0>&#34;name&#34;</span>:<span style=background-color:#fff0f0>&#34;user2&#34;</span><span style=color:red;background-color:#faa>}</span>] <span style=color:#333>|</span>
  <span style=color:#333>+</span><span style=color:#888>----------------------------------------------------+
</span></code></pre></div><p>In the above query we are aggregating all the JSON objects and using
<code>array_agg</code> and then converting them to JSON by applying <code>array_to_json</code>
function.</p><p>Also we could do the yield the same results by using <code>json_agg</code>
function, which results into an object instead of JSON string.</p><h2 id=4-build-json-object-with-multiple-tables><strong>4. Build JSON object with multiple tables</strong></h2><p>We can also build a new JSON object by using <code>json_build_object</code> and
specify the keys and values. Let&rsquo;s create an object that will contain
data from both team and user table.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>  <span style=color:#080;font-weight:700>SELECT</span> json_build_object(
    <span style=background-color:#fff0f0>&#39;users&#39;</span>, (<span style=color:#080;font-weight:700>SELECT</span> json_agg(row_to_json(<span style=background-color:#fff0f0>&#34;user&#34;</span>)) <span style=color:#080;font-weight:700>from</span> <span style=background-color:#fff0f0>&#34;user&#34;</span>),
    <span style=background-color:#fff0f0>&#39;teams&#39;</span>, (<span style=color:#080;font-weight:700>SELECT</span> json_agg(row_to_json(<span style=background-color:#fff0f0>&#34;team&#34;</span>)) <span style=color:#080;font-weight:700>from</span> <span style=background-color:#fff0f0>&#34;team&#34;</span>)
  )
</code></pre></div><p>This query generates a JSON structure that will have all the users and
teams each as arrays of objects.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>  {
    <span style=color:#070>&#34;users&#34;</span>: [
      {
        <span style=color:#070>&#34;id&#34;</span>: <span style=color:#00d;font-weight:700>1</span>,
        <span style=color:#070>&#34;name&#34;</span>: <span style=background-color:#fff0f0>&#34;user1&#34;</span>,
        <span style=color:#070>&#34;email_address&#34;</span>: <span style=background-color:#fff0f0>&#34;user1@mail.com&#34;</span>
      },
      {
        <span style=color:#070>&#34;id&#34;</span>: <span style=color:#00d;font-weight:700>2</span>,
        <span style=color:#070>&#34;name&#34;</span>: <span style=background-color:#fff0f0>&#34;user2&#34;</span>,
        <span style=color:#070>&#34;email_address&#34;</span>: <span style=background-color:#fff0f0>&#34;user2@mail.com&#34;</span>
      }
    ],
    <span style=color:#070>&#34;teams&#34;</span>: [
      {
        <span style=color:#070>&#34;id&#34;</span>: <span style=color:#00d;font-weight:700>1</span>,
        <span style=color:#070>&#34;name&#34;</span>: <span style=background-color:#fff0f0>&#34;team1&#34;</span>
      },
      {
        <span style=color:#070>&#34;id&#34;</span>: <span style=color:#00d;font-weight:700>2</span>,
        <span style=color:#070>&#34;name&#34;</span>: <span style=background-color:#fff0f0>&#34;team2&#34;</span>
      }
    ]
  }
</code></pre></div><h2 id=5-build-json-object-by-resolving-foreign-keys><strong>5. Build JSON object by resolving foreign keys</strong></h2><p>We can generate JSON structures by resolving foreign key references and
joining multiple tables.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>  <span style=color:#080;font-weight:700>select</span> json_agg(row_to_json(tu))
      <span style=color:#080;font-weight:700>from</span> (
          <span style=color:#080;font-weight:700>select</span> id, (
              <span style=color:#080;font-weight:700>select</span> row_to_json(team) <span style=color:#080;font-weight:700>from</span> team <span style=color:#080;font-weight:700>where</span> team_user.team_id <span style=color:#333>=</span> team.id
          ) team, (
              <span style=color:#080;font-weight:700>select</span> row_to_json(<span style=background-color:#fff0f0>&#34;user&#34;</span>) <span style=color:#080;font-weight:700>from</span> <span style=background-color:#fff0f0>&#34;user&#34;</span> <span style=color:#080;font-weight:700>where</span> team_user.user_id <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#34;user&#34;</span>.id
          ) <span style=background-color:#fff0f0>&#34;user&#34;</span>
      <span style=color:#080;font-weight:700>from</span> team_user
  ) tu
</code></pre></div><p>This query contains multiple sub-queries to generate a complex
structure. It resolved the references of <code>team_id</code> and <code>user_id</code> into
the corresponding row.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>[
    {
      <span style=color:#070>&#34;id&#34;</span>: <span style=color:#00d;font-weight:700>1</span>,
      <span style=color:#070>&#34;team&#34;</span>: {
        <span style=color:#070>&#34;id&#34;</span>: <span style=color:#00d;font-weight:700>1</span>,
        <span style=color:#070>&#34;name&#34;</span>: <span style=background-color:#fff0f0>&#34;team1&#34;</span>
      },
      <span style=color:#070>&#34;user&#34;</span>: {
        <span style=color:#070>&#34;id&#34;</span>: <span style=color:#00d;font-weight:700>1</span>,
        <span style=color:#070>&#34;name&#34;</span>: <span style=background-color:#fff0f0>&#34;user1&#34;</span>,
        <span style=color:#070>&#34;email_address&#34;</span>: <span style=background-color:#fff0f0>&#34;user1@mail.com&#34;</span>
      }
    },
    {
      <span style=color:#070>&#34;id&#34;</span>: <span style=color:#00d;font-weight:700>2</span>,
      <span style=color:#070>&#34;team&#34;</span>: {
        <span style=color:#070>&#34;id&#34;</span>: <span style=color:#00d;font-weight:700>1</span>,
        <span style=color:#070>&#34;name&#34;</span>: <span style=background-color:#fff0f0>&#34;team1&#34;</span>
      },
      <span style=color:#070>&#34;user&#34;</span>: {
        <span style=color:#070>&#34;id&#34;</span>: <span style=color:#00d;font-weight:700>2</span>,
        <span style=color:#070>&#34;name&#34;</span>: <span style=background-color:#fff0f0>&#34;user2&#34;</span>,
        <span style=color:#070>&#34;email_address&#34;</span>: <span style=background-color:#fff0f0>&#34;user2@mail.com&#34;</span>
      }
    },
    {
      <span style=color:#070>&#34;id&#34;</span>: <span style=color:#00d;font-weight:700>3</span>,
      <span style=color:#070>&#34;team&#34;</span>: {
        <span style=color:#070>&#34;id&#34;</span>: <span style=color:#00d;font-weight:700>2</span>,
        <span style=color:#070>&#34;name&#34;</span>: <span style=background-color:#fff0f0>&#34;team2&#34;</span>
      },
      <span style=color:#070>&#34;user&#34;</span>: {
        <span style=color:#070>&#34;id&#34;</span>: <span style=color:#00d;font-weight:700>2</span>,
        <span style=color:#070>&#34;name&#34;</span>: <span style=background-color:#fff0f0>&#34;user2&#34;</span>,
        <span style=color:#070>&#34;email_address&#34;</span>: <span style=background-color:#fff0f0>&#34;user2@mail.com&#34;</span>
      }
    }
  ]
</code></pre></div><h2 id=conclusion><strong>Conclusion</strong></h2><p>Even though PostgreSQL is almost always faster than the back-end
language based JSON generation, the query can get complex really quickly
as we have nested structures. As long as we understand the basic JSON
functions and sub-queries we can build almost any kind of structure
without stressing the back-end processes.</p></div></main><footer><div class=bottom-nav><nav><ul><li><a href=/about/>about</a></li><li><a href=/logs/>logs</a></li><li><a href=/privacy/>privacy</a></li></ul></nav></div><div><script src=https://utteranc.es/client.js repo=mrprofessor/rudra.dev issue-term=pathname label=rudra.dev theme=github-light crossorigin=anonymous async></script></div></footer></div></body><script>(function(){const links=document.querySelectorAll("nav a")
const currentUrl=location.href
for(const link of links){if(location.href.split("/").length===4&&link.href.endsWith("/posts/")){link.classList.add("active-link")
break;}
if(link.href===currentUrl){link.classList.add("active-link")}}}())</script><script>!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);posthog.init('uZJ_bhngsKFhhPaqWyp_2lc-HyE8vY5XKneeAMWS9cE',{api_host:'https://profhog.herokuapp.com'})</script><script async src=https://prof-ackee.herokuapp.com/tracker.js data-ackee-server=https://prof-ackee.herokuapp.com data-ackee-domain-id=45af9210-721f-4c09-a69d-77e66fe7bc5d></script></html>